<tool id="mogsa" name="MOGSA" version="0.1.0">
    <description>Integrative single sample gene-set analysis of multiple omics data</description>
    <requirements>
        <requirement type="package" version="1.20.3">r-getopt</requirement>
        <requirement type="package" version="1.24.0">bioconductor-mogsa</requirement>
        <requirement type="package" version="0.17">r-DT</requirement>
        <requirement type="package" version="2.6">r-rmarkdown</requirement>
        <requirement type="package" version="3.1.1">r-gplots</requirement>
        <requirement type="package" version="4.2.3">r-openxlsx</requirement>
        <requirement type="package" version="1.31">r-knitr</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        Rscript '$__tool_directory__/mogsa.R' 
        --data_file  '$data_file' 
        --geneSet_file '$geneSet' 
        --design_file '$desigin' 
        --PC_number '$pc_number' 
        --w_data '$adv.w_data'  
        --proc_row '$adv.proc_row' 
        --ks_B '$adv.ks_B' 
        --p_adjust_method '$adv.p_adjust_method' 
        --output_file '$mogsa_result'

    ]]></command>
    <inputs>
        <param name="data_file" type="data" format="xlsx" label="Omics data" help="An Excel file, which included multiple omics data that each sheet has one matrix for the omics data. More details see help." />
        <param name="desigin" type="data" format="CSV" label="Design" help="A CSV file that has three columns. More details see help."/>
        <param name="geneSet" type="data" format="rdata" label="Gene Set" help="An rdata file included geneSetCollection object 'geneSet' as name."/>
        <param name="pc_number" type="integer" value="3" min="2" label="PC number" help="The number of principal components used to reconstruct." />
        
        <section name="adv" title="Advance Options">
            <param name="w_data" type="select" label="The weights of each separate dataset" >
                <option value="uniform">no weighting</option>
                <option value="lambda1">weighted by the reverse of the first eigenvalue of each individual dataset</option>
                <option value="inertia" selected="true">weighted by the reverse of the total inertia</option>
            </param>
            <param name="proc_row" type="select" label="Preprocessing of rows of datasets">
                <option value="none">no preprocessing</option>
                <option value="center">center only</option>
                <option value="center_ssq1" selected="true">center and scale (sum of squred values equals 1)</option>
                <option value="center_ssqN">center and scale (sum of squred values equals the number of columns)</option>
                <option value="center_ssqNm1">center and scale (sum of squred values equals the number of columns - 1) </option>
            </param>
            <param name="ks_B" type="integer" value="1000" min="100" label="The number of bootstrapping samples"  help="An integer to indicate the number of bootstrapping samples to calculated the p-value of KS statistic." />
            <param name="p_adjust_method" type="select" label="P-value adjust method">
                <option value="holm">holm</option>
                <option value="hochberg">hochberg</option>
                <option value="hommel">hommel</option>
                <option value="bonferroni">bonferroni</option>
                <option value="BH" selected="true" >BH</option>
                <option value="BY">BY</option>
                <option value="fdr">fdr</option>
                <option value="none">none</option>
            </param>
        </section>
        
        
    </inputs>
    <outputs>
        <data name="mogsa_result" format="zip" label="mogsa_result" />
    </outputs>
    <help><![CDATA[

.. class:: infomark 

**What it does**

MOGSA (Multiple omics data integration and gene set analysis) is a new integrative multi omics single sample gene set analysis method. 
The method learns a low dimensional  representation of most variant correlated features
(genes, proteins, etc.) across multiple omics data sets,  transforms the features onto the same scale and calculates  an integrated 
gene-set score from the most informative  features in each data type. MOGSA does not require  filtering data to the intersection of 
features (gene IDs),  therefore, all molecular features, including those that lack  annotation may be included in the analysis


---------

==========
**Inputs**
==========

Basic Options
--------------

**Omics data**

Omics data asked an excel file that has many sheets included matrix of omics data. Sheet names are the source of omics data. 
The matrix must has the same rownames and colnames, rows are genes and columns are sample.


**Design**

Design is a CSV file, which has `sample`, `label` and `colcode` three columns. `sample` corresponds to Omics data, `label` is 
for different type of `sample`. And `colcode` is colour to group for heatmap.

**Gene Set**

Gene Sets is an rdata file which included object `geneSet` that is geneSetCollection built by `GSEABase` of bioconductor package. You can use 
GeneSet from Msigdb/KEGG to get this file. You must pay attention to set the gene id type is the same of Gene expression data.

Notes: The genes ID should be the same of the rownames of Omics data.


**PC number**

In practice, one need to detemine how many PCs should be retained in the step of reconstructing gene set score matrix. In our results, 
we plot a scree plot of the eigenvalues, which result from the multivariate analysis. We can take the better number of PC as input. Default 
as 3.


Advanced Options
-----------------

**The weights of each separate dataset**

The weights of each separate dataset, should be one of uniform - no weighting,
lambda1 - weighted by the reverse of the first eigenvalue of each individual dataset
or inertia - weighted by the reverse of the total inertia. 

MFA (multiple factorial analysis) corresponds to choose lambda1.

**Preprocessing of rows of datasets**
Preprocessing of rows of datasets, should be one of none - no preprocessing, 
center - center only, center_ssq1 - center and scale (sum of squred values equals 1), 
center_ssqN - center and scale (sum of squred values equals the number of columns), 
center_ssqNm1 - center and scale (sum of squred values equals the number of columns - 1).

MFA (multiple factorial analysis) corresponds to choose center_ssq1.


**The number of bootstrapping samples**

An integer to indicate the number of bootstrapping samples to calculated the p-value of KS statistic. Defalut as 1000.

**P-value adjust method**

Choose one method to adjust p-value. Here supposted `"BH"`, `"holm"`, `"hochberg"`, `"hommel"`, `"bonferroni"`, `"BY"`, `"fdr"` and `"none"`. Default as `"BH"`.


------

==========
**Output**
==========

An ZIP file included the plot of varuabce of PC, gene set score matrix, P-value and decomposition of gene set scores and gene influential scores.
The main file is `mogsa.html`.

        
    ]]></help>
    <citations>
        <citation type="doi">10.1074/mcp.TIR118.001251</citation>
    </citations>
</tool>